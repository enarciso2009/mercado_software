{% extends "base.html" %}

{% block content %}

<div class="container mt-4">

    <h4>
        Conversa sobre: <strong>{{ interesse.software.nome }}</strong>
    </h4>

    <hr>

    <!-- AREA DO CHAT -->
    <div id="chat-box"
         style="
            height:400px;
            overflow-y:auto;
            background:#f8f9fa;
            padding:15px;
            border-radius:10px;
         ">

        <!-- primeira mensagem -->
        <div class="mb-3">
            <strong>{{ interesse.usuario.username }}</strong><br>
            <div class="p-2 bg-light rounded">
                {{ interesse.mensagem }}
            </div>
        </div>

        <!-- mensagens -->
        {% for msg in interesse.mensagens.all %}

            {% if msg.autor == request.user %}

                <div class="text-end mb-3">

                    <div class="d-inline-block p-2 rounded"
                         style="background:#0d6efd;color:white;max-width:70%;">
                        {{ msg.mensagem }}
                    </div>

                    <br>

                    <small class="text-muted">
                        {{ msg.criada_em|date:"d/m/Y H:i" }}
                    </small>

                </div>

            {% else %}

                <div class="text-start mb-3">

                    <div class="d-inline-block p-2 rounded"
                         style="background:#e9ecef;max-width:70%;">
                        {{ msg.mensagem }}
                    </div>

                    <br>

                    <small class="text-muted">
                        {{ msg.autor.username }} â€¢ {{ msg.criada_em|date:"d/m/Y H:i" }}
                    </small>

                </div>

            {% endif %}

        {% endfor %}

    </div>

    <hr>

    <!-- FORM -->
    <form method="post"
          action="{% url 'softwares:mensagem_interesse_create' interesse.pk %}">

        {% csrf_token %}

        <div class="input-group">

            {{ form.mensagem }}

            <button class="btn btn-primary">
                Enviar
            </button>

        </div>

    </form>

</div>


<!-- auto scroll -->
<script>
    const chatBox = document.getElementById('chat-box');
    chatBox.scrollTop = chatBox.scrollHeight;
</script>


{% endblock %}
